<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guess the Category</title>
    <style>
        /* style.css content */
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column; /* Changed to column to stack children vertically */
            justify-content: flex-start; /* Align to top */
            align-items: center; /* Center horizontally */
            min-height: 100vh;
            background-color: #f4f4f4; /* Default background */
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            transition: background-color 0.5s ease; /* Smooth transition for background color */
        }

        /* New background colors */
        body.correct-bg {
            background-color: #90CAF9; /* Slightly darker blue for win */
        }

        body.incorrect-bg {
            background-color: #FFB3B3; /* Slightly darker red for loss */
        }

        .game-container {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 100%;
            max-width: 600px;
            position: relative; /* Needed for absolute positioning of child background */
            overflow: hidden; /* To contain the background image if it overflows */
            padding-bottom: 120px; /* Increased padding to make more space for the image and messages */
        }

        /* New div for background image inside game-container */
        .game-background-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('GTC-12345QuestionMark.jpg');
            background-repeat: no-repeat;
            background-position: center top; /* Position it at the top center */
            background-size: 80% auto; /* Adjust size to fit well */
            opacity: 0.1; /* Make it subtle */
            z-index: 0; /* Ensure it's behind content */
        }

        /* Image at the bottom of game-container */
        .bottom-image {
            position: absolute;
            bottom: 20px; /* Adjusted bottom position to create more space below it */
            left: 50%;
            transform: translateX(-50%);
            width: 100px; /* Adjust size as needed */
            height: auto;
            opacity: 0.8; /* Make it slightly transparent */
            z-index: 1; /* Ensure it's above the game-background-image */
        }


        /* Ensure foreground content is above the background image */
        .difficulty-buttons, h1, .subtitle, table, .guess-section, #incorrectGuesses, #playAgainButton, #message {
            position: relative; /* Bring these elements above the background image */
            z-index: 1;
        }

        h1 {
            color: #333;
            margin-top: 30px; /* Added more space above */
            margin-bottom: 30px; /* Adjusted space below */
        }

        .subtitle {
            font-size: 0.9em;
            color: black; /* Black text */
            background-color: #f0f0f0; /* Light grey background */
            padding: 15px 20px; /* Padding inside the box */
            border-radius: 8px; /* Rounded corners for the box */
            margin: 0 auto 50px auto; /* Center the box and add space below */
            max-width: 310px; /* 50% of the table's max-width (600px) */
            line-height: 1.4;
            box-sizing: border-box; /* Include padding in width calculation */
        }

        .difficulty-buttons {
            margin-bottom: 20px;
        }

        .difficulty-buttons button {
            padding: 10px 20px;
            margin: 0 5px; /* Adjusted margin for three buttons */
            background-color: #6c757d; /* Default gray */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .difficulty-buttons button:hover {
            background-color: #5a6268;
        }

        /* Specific colors for selected difficulty buttons */
        #easyButton.selected {
            background-color: #65e365; /* Light Green */
        }
        #mediumButton.selected {
            background-color: #6abff5; /* Lighter Blue */
        }
        #hardButton.selected {
            background-color: #F06F6F; /* Light Red */
        }
        #ultraButton.selected {
            background-color: #DC143C; /* Cherry Red */
            box-shadow: 0 0 15px #DC143C, 0 0 45px #DC143C, 0 0 60px #DC143C; /* Pulsing effect */
            animation: pulse-fire 0.5s infinite alternate;
        }

        @keyframes pulse-fire {
            0% { box-shadow: 0 0 15px #DC143C, 0 0 30px #DC143C, 0 0 45px #DC143C; }
            100% { box-shadow: 0 0 25px #DC143C, 0 0 50px #DC143C, 0 0 75px #DC143C; }
        }


        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        /* Set the width for the first column (Clue #) */
        th:first-child,
        td:first-child {
            width: 20%; /* Changed to 20% */
        }

        th {
            background-color: #e9e9e9; /* Light gray for table header */
            color: #555;
        }

        tr.hidden {
            display: none;
        }

        tr.answer-row td {
            font-weight: bold;
            background-color: #e6ffe6; /* Light green for the answer row */
        }

        /* New style for correctly guessed clues */
        tr.correct-clue-revealed td {
            background-color: #333;
            color: white;
        }

        /* New style for answer row when game is lost */
        tr.answer-row.lost-game td {
            background-color: #FFDDDD; /* Light red for lost answer row */
        }

        .guess-section {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        #guessInput {
            padding: 10px;
            width: calc(100% - 20px);
            max-width: 300px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
        }

        #submitGuess, #playAgainButton {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s ease;
        }

        #submitGuess:hover, #playAgainButton:hover {
            background-color: #0056b3;
        }

        #playAgainButton {
            margin-top: 20px;
            background-color: #28a745; /* Green for play again */
        }

        #playAgainButton:hover {
            background-color: #218838;
        }

        /* Shake animation */
        @keyframes shake {
            0% { transform: translateX(0); }
            10% { transform: translateX(-10px); }
            20% { transform: translateX(10px); }
            30% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            50% { transform: translateX(-10px); }
            60% { transform: translateX(10px); }
            70% { transform: translateX(-10px); }
            80% { transform: translateX(10px); }
            90% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        .hidden {
            display: none;
        }

        #message {
            margin-top: 15px;
            font-weight: bold;
            color: red; /* For incorrect guesses */
        }

        #incorrectGuesses {
            margin-top: 10px;
            color: #888;
            font-size: 0.9em;
            min-height: 20px; /* To prevent layout shift */
        }

        #incorrectGuesses del {
            color: #b3b3b3;
            margin: 0 5px;
        }

        /* Confetti styles */
        #confetti-container, #emoji-container, #balloon-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Allows clicks to pass through */
            overflow: hidden;
            z-index: 9999; /* Ensure it's on top */
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00; /* Default, will be overridden by JS */
            opacity: 0;
            animation: fall 3s forwards;
            border-radius: 50%; /* Make it round */
        }

        .emoji {
            position: absolute;
            font-size: 24px; /* Size of the emoji */
            opacity: 0;
            animation: fall 3s forwards; /* Use the same fall animation */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2); /* Add a slight shadow for visibility */
        }

        @keyframes fall {
            0% {
                transform: translate(var(--x), var(--y)) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            100% {
                transform: translate(var(--x-end), var(--y-end)) rotate(720deg);
                opacity: 0;
            }
        }

        /* Balloon styles */
        .balloon {
            position: absolute;
            width: 30px;
            height: 40px;
            background-color: #f00; /* Default, will be overridden by JS */
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            opacity: 0;
            animation: shoot-from-sides 5s forwards; /* Changed animation name */
            box-shadow: inset -3px -3px rgba(0,0,0,0.1);
        }

        .balloon::before {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 1px;
            height: 15px;
            background-color: rgba(0,0,0,0.3);
            border-radius: 0 0 50% 50%;
        }

        @keyframes shoot-from-sides { /* New keyframes for side shooting */
            0% {
                transform: translate(var(--x-start), var(--y)) rotate(var(--rotate-start));
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            100% {
                transform: translate(var(--x-end), var(--y-end)) rotate(var(--rotate-end));
                opacity: 0;
            }
        }

        .version-tag {
            font-size: 0.6em; /* Very small print */
            color: #777;
            margin-top: 10px; /* Space above the tag to push it below the game-container */
        }

        .version-tag a { /* Targeting the link within the version tag */
            color: #777; /* Gray color for the link */
            text-decoration: none; /* Remove underline */
        }

        .version-tag a:hover {
            text-decoration: underline; /* Add underline on hover for interactivity */
        }

        .version-container {
            /* This div now naturally flows below game-container due to body's flex-direction: column */
            /* No specific styling needed here unless you want to constrain its width or add padding */
        }

        /* Timer styles */
        #timerDisplay {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex; /* Use flexbox to align text and number */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            gap: 10px; /* Space between "Seconds left:" and number */
            color: gray; /* Default color for the whole timer display */
        }
        #timerDisplay span { /* Style for the numerical part of the timer */
             transition: color 1s linear; /* Keep transition for the number itself */
             color: inherit; /* Inherit color from parent, which will be set by JS */
        }
        #timerDisplay.blue-text span {
            color: blue !important; /* Force blue on win */
        }
        #timerDisplay.red-text span {
            color: red !important; /* Force red on run out or win with time left */
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-background-image"></div>
        <div class="difficulty-buttons">
            <button id="easyButton">Easy</button>
            <button id="mediumButton">Medium</button>
            <button id="hardButton">Hard</button>
            <button id="ultraButton">Ultra</button>
        </div>
        <h1>Guess the Category!</h1>
        <p class="subtitle">Guess a hidden category or phrase by receiving five clues, one at a time.</p>

        <div id="timerDisplay" class="hidden"><span id="timeRemaining"></span></div>
        <table id="clueTable">
            <thead>
                <tr>
                    <th>Clue #</th>
                    <th>Clue</th>
                </tr>
            </thead>
            <tbody>
                <tr id="clue1-row" class="hidden"><td>1</td><td id="clue1"></td></tr>
                <tr id="clue2-row" class="hidden"><td>2</td><td id="clue2"></td></tr>
                <tr id="clue3-row" class="hidden"><td>3</td><td id="clue3"></td></tr>
                <tr id="clue4-row" class="hidden"><td>4</td><td id="clue4"></td></tr>
                <tr id="clue5-row" class="hidden"><td>5</td><td id="clue5"></td></tr>
                <tr id="answer-row" class="hidden answer-row"><td>Answer</td><td id="answer"></td></tr>
            </tbody>
        </table>

        <div class="guess-section">
            <input type="text" id="guessInput" placeholder="Enter your guess" autocomplete="off">
            <button id="submitGuess">Submit Guess</button>
        </div>

        <p id="incorrectGuesses"></p>
        <button id="playAgainButton" class="hidden">Play Again?</button>

        <p id="message"></p>

        <img src="GTC-12345QuestionMark.jpg" alt="Question Mark Image" class="bottom-image">
    </div>

    <div id="version-container">
        <p id="versionTag" class="version-tag">Last updated: <span id="last-updated"></span> - <a href="https://neilschreiner.github.io/">&copy; neil</a> - <a href="https://github.com/neilschreiner/GuessTheCategory/blob/1e7c23010e8bac0af8d4786db867d07f02b51bf9/LICENSE">MIT License</a></p>
    </div>

    <div id="confetti-container"></div>
    <div id="emoji-container"></div>
    <div id="balloon-container"></div>

    <script>
        // script.js content
        document.addEventListener('DOMContentLoaded', () => {
            const body = document.body;
            const easyButton = document.getElementById('easyButton');
            const mediumButton = document.getElementById('mediumButton');
            const hardButton = document.getElementById('hardButton');
            const ultraButton = document.getElementById('ultraButton');
            const clueTableBody = document.querySelector('#clueTable tbody');
            const guessInput = document.getElementById('guessInput');
            const submitGuessButton = document.getElementById('submitGuess');
            const playAgainButton = document.getElementById('playAgainButton');
            const messageDisplay = document.getElementById('message');
            const incorrectGuessesDisplay = document.getElementById('incorrectGuesses');
            const confettiContainer = document.getElementById('confetti-container');
            const emojiContainer = document.getElementById('emoji-container');
            const balloonContainer = document.getElementById('balloon-container');
            const timerDisplay = document.getElementById('timerDisplay');
            const timeRemainingSpan = document.getElementById('timeRemaining');

            let gameData = [];
            let currentRow = [];
            let currentClueIndex = 0;
            const maxClues = 5;
            let confettiInterval;
            let sadEmojiInterval;
            let happyEmojiInterval;
            let balloonInterval;
            let lastUsedGameIndex = -1;

            let currentDifficulty = 'easy';
            let timerInterval;
            let timeLeft = 0;
            const ULTRA_TIME_LIMIT = 30;

            // Helper function to normalize strings for comparison
            function normalizeString(str) {
                return str.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~() ]/g, "").replace(/\s/g, '');
            }

            // Helper function to check for similar answers
            function isSimilarAnswer(playerGuess, correctAnswer) {
                const normalizedPlayer = normalizeString(playerGuess);
                const normalizedCorrect = normalizeString(correctAnswer);

                if (normalizedPlayer === normalizedCorrect) {
                    return true;
                }

                if (normalizedCorrect.includes(normalizedPlayer) && normalizedPlayer.length > 2) {
                    return true;
                }

                if (normalizedPlayer.includes(normalizedCorrect) && normalizedCorrect.length > 2) {
                     return true;
                }

                return false;
            }

            // Easy CSV data (100+ entries)
            const easyCsvData = `
"Has a trunk", "Can be found in Africa or Asia", "Eats plants", "Often grey", "Largest land animal", "Elephant"
"You read them", "Have pages", "Contain stories or information", "Found in libraries", "Can be hard or soft cover", "Books"
"You wear them on your feet", "Protect your feet", "Can be made of leather", "Come in pairs", "Different styles for different occasions", "Shoes"
"It's a color", "Often associated with the sky or ocean", "Can be found in nature", "One of the primary colors", "Associated with sadness sometimes", "Blue"
"It's a fruit", "Can be red or green", "Grows on trees", "Often used in pies", "Keeps the doctor away", "Apple"
"A place for learning", "Has classrooms and teachers", "Students attend here", "You go to get an education", "Can be public or private", "School"
"A small, furry animal", "Known for eating cheese", "Often found in houses", "Has a long tail", "Can be a pet or a pest", "Mouse"
"A musical instrument", "Has black and white keys", "You press the keys to make sound", "Can be grand or upright", "Often found in concert halls", "Piano"
"A type of weather", "Water falling from the sky", "Can be light or heavy", "Often accompanied by thunder", "Makes plants grow", "Rain"
"A hot beverage", "Made from roasted beans", "Often drunk in the morning", "Can be black or with milk", "Has caffeine", "Coffee"
"A large body of water", "Covers most of the Earth", "Has waves and tides", "Home to many sea creatures", "You can swim or sail on it", "Ocean"
"A place where animals live", "Can be hot or cold", "Has many trees and plants", "Home to wild animals", "You can hike or explore here", "Forest"
"A small, round fruit", "Often red or purple", "Grows in bunches on vines", "Used to make wine", "Sweet and juicy", "Grape"
"A yellow citrus fruit", "Sour taste", "Used in drinks and cooking", "Rich in Vitamin C", "Can be squeezed for juice", "Lemon"
"A domesticated animal", "Known for barking", "Man's best friend", "Can be a pet or a working animal", "Loyal and playful", "Dog"
"A large bird", "Cannot fly", "Native to Australia", "Known for its long neck and legs", "Fast runner", "Emu"
"A sweet treat", "Made from cocoa beans", "Comes in bars or pieces", "Can be dark, milk, or white", "Often given as a gift", "Chocolate"
"A frozen dessert", "Made from milk and sugar", "Comes in many flavors", "Often served in a cone or bowl", "Melts quickly in the sun", "Ice Cream"
"A popular sport", "Played with a ball and a net", "Two teams compete", "Can be played indoors or outdoors", "Requires running and jumping", "Basketball"
"A type of transportation", "Has two wheels", "You pedal to move it", "Good for exercise", "Can be ridden on roads or trails", "Has handlebars and a seat", "Bicycle"
"A place to buy food", "Has many aisles", "Sells fresh produce and packaged goods", "You use a cart to shop", "Often has a bakery and deli", "Grocery Store"
"A small, winged insect", "Known for making honey", "Lives in a hive", "Pollinates flowers", "Can sting", "Bee"
"A large, green vegetable", "Has many layers", "Can be eaten raw or cooked", "Often used in salads or soups", "Has a strong smell when cut", "Onion"
"A small, furry rodent", "Known for storing nuts", "Has a bushy tail", "Lives in trees", "Active in the daytime", "Squirrel"
"A type of music", "Often played with guitars and drums", "Has a strong beat", "Popular with young people", "Can be loud and energetic", "Rock"
"A hot drink", "Made from dried leaves", "Often served with milk and sugar", "Comes in many varieties", "Popular in the UK", "Tea"
"A large, flightless bird", "Native to Africa", "Known for its speed", "Lays the largest eggs", "Can be ridden in some places", "Ostrich"
"A building for books", "People go there to read or study", "You can borrow books for free", "Has quiet reading areas", "Often has computers and Wi-Fi", "Library"
"A round, orange fruit", "Has a thick peel", "Can be peeled and eaten", "Used for juice", "Rich in Vitamin C", "Associated with sunshine", "Orange"
"A place to watch movies", "Has a big screen and comfortable seats", "You buy tickets to enter", "Sells popcorn and drinks", "Dark inside during the show", "Movie Theater"
"A small, green vegetable", "Grows in pods", "Often eaten steamed or boiled", "Sweet taste", "Good source of protein and fiber", "Pea"
"A large, wild cat", "Known for its stripes", "Native to Asia", "A powerful predator", "Can roar loudly", "Tiger"
"A game played with cards", "Many different variations", "Can be for one or more players", "Involves strategy and luck", "Often played for fun or money", "Poker"
"A yellow fruit", "Grows in tropical climates", "Has a curved shape", "Peel before eating", "Favorite food of monkeys", "Good source of potassium", "Banana"
"A popular board game", "Involves buying and selling properties", "Uses dice and tokens", "Goal is to bankrupt opponents", "Has a famous top hat piece", "Monopoly"
"A cold, sweet drink", "Often carbonated", "Comes in many flavors", "Served in bottles or cans", "Can be diet or regular", "Soda"
"A large, aquatic mammal", "Lives in the ocean", "Known for its blowhole", "Can be very large", "Sings complex songs underwater", "Whale"
"A small, flying insect", "Known for biting", "Can spread diseases", "Active in warm weather", "Makes a buzzing sound", "Mosquito"
"A type of footwear", "Worn on the foot and ankle", "Can be for sports or fashion", "Often made of canvas or leather", "Has laces", "Sneaker"
"A green vegetable", "Has a tree-like appearance", "Often steamed or roasted", "Good source of vitamins", "Part of the cabbage family", "Broccoli"
"You wear it on your head", "Keeps you warm or blocks sun", "Can be made of wool or straw", "Different styles like baseball or cowboy", "Often has a brim", "Hat"
"You sit on it", "Has four legs and a back", "Found in homes or offices", "Used for dining or working", "Can be made of wood or metal", "Chair"
"A place to sleep", "Has a mattress and pillows", "Found in a bedroom", "You lie down on it at night", "Can be single, double, or king size", "Bed"
"A place to wash hands", "Has a faucet and drain", "Found in a bathroom or kitchen", "Water comes out of it", "Can be ceramic or metal", "Sink"
"You use it to see at night", "Needs batteries", "Has a light bulb", "You hold it in your hand", "Good for camping or power outages", "Flashlight"
"You wear them on your hands", "Keeps them warm", "Comes in pairs", "Can be made of wool or leather", "Used in cold weather", "Gloves"
"A place to store clothes", "Has hangers and shelves", "Found in a bedroom", "You open its doors", "Can be walk-in or built-in", "Closet"
"A small, round fruit", "Often red or green", "Grows on trees", "Used in pies or eaten fresh", "Keeps the doctor away", "Apple"
"A yellow citrus fruit", "Very sour", "Used in lemonade", "Rich in Vitamin C", "Often sliced for drinks", "Lemon"
"A large body of water", "Salty and vast", "Home to fish and whales", "Has waves and currents", "Covers most of the Earth", "Ocean"
"A domesticated animal", "Known for barking", "Loyal and friendly", "Can be a guard or a companion", "Comes in many breeds", "Dog"
"A sweet frozen treat", "Made from milk and sugar", "Comes in many flavors", "Served in cones or bowls", "Melts on a hot day", "Ice Cream"
"A sport with a ball and hoop", "Players dribble and shoot", "Two teams compete", "Played on a court", "Michael Jordan was famous for it", "Basketball"
"A two-wheeled vehicle", "Powered by pedaling", "Good for exercise", "Can be ridden on roads or trails", "Has handlebars and a seat", "Bicycle"
"A place to buy groceries", "Has aisles of food", "You use a shopping cart", "Sells fruits, vegetables, vegetables, meat", "Has a checkout counter", "Grocery Store"
"A small flying insect", "Makes honey", "Lives in a hive", "Pollinates flowers", "Can sting", "Bee"
"A green vegetable", "Has many layers", "Can make you cry when cut", "Used in salads and cooking", "Has a strong smell", "Onion"
"A small rodent", "Known for bushy tail", "Climbs trees", "Eats nuts and seeds", "Often seen in parks", "Squirrel"
"A genre of music", "Often loud and energetic", "Uses guitars, drums, bass", "Popular with young people", "Artists like Queen and Led Zeppelin", "Rock"
"A warm drink", "Made from leaves steeped in hot water", "Can be black, green, or herbal", "Often served with milk or lemon", "Popular in the morning or afternoon", "Tea"
"A large flightless bird", "Native to Africa", "Known for its speed", "Lays the largest eggs", "Can be ridden in some places", "Ostrich"
"A place for books", "You can borrow stories", "Has quiet reading areas", "Often has computers and Wi-Fi", "A public resource for knowledge", "Library"
"A round, citrus fruit", "Orange in color", "Can be peeled and eaten", "Used for juice", "Rich in Vitamin C", "Associated with sunshine", "Orange"
"A place to watch movies", "Has a big screen", "Sells popcorn and candy", "You buy tickets to enter", "Dark inside during the show", "Movie Theater"
"A small green vegetable", "Grows in pods", "Often found in frozen bags", "Sweet when cooked", "A good source of fiber", "Pea"
"A striped wild cat", "Native to Asia", "A powerful hunter", "Known for its roar", "Largest cat species", "Tiger"
"A card game", "Involves betting and and strategy", "Players try to get the best hand", "Can be played with friends or in casinos", "Often associated with chips", "Poker"
"A curved yellow fruit", "Grows in bunches", "Peel before eating", "Favorite food of monkeys", "Good source of potassium", "Banana"
"A board game", "Buy and sell properties", "Try to bankrupt opponents", "Roll dice to move", "Has properties like Park Place and Boardwalk", "Monopoly"
"A carbonated drink", "Sweet and fizzy", "Comes in many flavors", "Served cold", "Can be diet or regular", "Soda"
"A large, aquatic mammal", "Lives in the ocean", "Known for its blowhole", "Can be very large", "Sings complex songs underwater", "Whale"
"A small, flying insect", "Known for biting", "Can spread diseases", "Active in warm weather", "Makes a buzzing sound", "Mosquito"
"A type of footwear", "Worn on the foot and ankle", "Can be for sports or fashion", "Often made of canvas or leather", "Has laces", "Sneaker"
"A green vegetable", "Has a tree-like appearance", "Often steamed or roasted", "Good source of vitamins", "Part of the cabbage family", "Broccoli"
`;

            // Medium CSV data (previously Hard + 200 new entries) embedded directly in the JavaScript
            const mediumCsvData = `
"A complex system of rules", "Governs a society or country", "Enforced by courts and police", "Can be civil or criminal", "Often studied by lawyers", "Law"
"A celestial body", "Orbits a star", "Can be rocky or gaseous", "Eight officially recognized in our solar system", "Earth is one", "Planet"
"A form of communication", "Uses written or spoken words", "Can be formal or informal", "Varies across cultures", "English, Spanish, Mandarin", "Language"
"A field of study", "Deals with numbers and shapes", "Used in science and engineering", "Includes algebra, geometry, calculus", "Can be abstract or applied", "Mathematics"
"A period of time", "Often associated with specific weather", "Four main types: spring, summer, autumn, winter", "Affects plants and animals", "Determines holidays and activities", "Season"
"A natural phenomenon", "Involves light and sound", "Occurs during thunderstorms", "Can be dangerous", "Often followed by rain", "Lightning"
"A type of art", "Uses a brush and pigments", "Can be realistic or abstract", "Displayed in galleries and museums", "Mona Lisa is example", "Painting"
"A device for telling time", "Can be worn on the wrist", "Has hands or digital display", "Often a fashion accessory", "Can be automatic or battery-powered", "Watch"
"A type of building", "Often tall with many floors", "Used for offices or apartments", "Found in cities", "Can have a lobby and elevators", "Skyscraper"
"A small, fast-moving particle", "Carries an electric charge", "Orbits the nucleus of an atom", "Fundamental to electricity", "Discovered by J.J. Thomson", "Electron"
"A literary form", "Written in verse", "Often uses rhythm and rhyme", "Can express emotions or tell stories", "Shakespeare wrote many", "Poetry"
"A type of energy", "Produced by the sun", "Essential for plant growth", "Can be converted into electricity", "Travels in waves", "Light"
"A system of beliefs", "Often involves a higher power", "Provides moral guidance", "Practiced by many people worldwide", "Can have rituals and ceremonies", "Religion"
"A scientific instrument", "Used to see very small objects", "Has lenses and magnification", "Invented by Zacharias Janssen", "Essential in biology and medicine", "Microscope"
"A type of government", "Ruled by the people", "Citizens have voting rights", "Can be direct or representative", "United States is an example", "Democracy"
"A natural satellite", "Orbits a planet", "Our planet has one", "Causes tides on Earth", "Has phases like crescent and full", "Moon"
"A chemical element", "Atomic number 6", "Forms the basis of all organic life", "Found in diamonds and graphite", "Essential for photosynthesis", "Carbon"
"A form of entertainment", "Performed on a stage", "Involves actors and a script", "Can be a tragedy or comedy", "Often has an audience", "Theater"
"A type of weather phenomenon", "A rotating column of air", "Can cause widespread destruction", "Often forms during thunderstorms", "Common in 'Tornado Alley'", "Tornado"
"A period of history", "Characterized by significant change", "Often involves new inventions or ideas", "Can be social, political, or technological", "The Industrial Revolution is one", "Revolution"
"A unit of measurement", "Used for temperature", "Has degrees Celsius or Fahrenheit", "Invented by Anders Celsius", "Water freezes at 0 degrees Celsius", "Thermometer"
"A type of art", "Uses a camera to capture images", "Can be black and white or color", "Often displayed in frames or albums", "Ansel Adams was famous for it", "Photography"
"A celestial event", "Occurs when one body passes in front of another", "Can be solar or lunar", "Rare and often spectacular", "Requires specific alignment of celestial bodies", "Eclipse"
"A branch of science", "Studies the Earth's physical structure", "Includes rocks, minerals, and landforms", "Helps understand natural disasters", "Often involves field work", "Geology"
"A type of literary work", "A long narrative poem", "Often tells of heroic deeds", "Features gods or mythical beings", "The Odyssey is an example", "Epic"
"A system of writing", "Uses pictures or symbols", "Ancient Egyptians used it", "Can be complex and detailed", "Often found on monuments or tombs", "Hieroglyphics"
"A musical composition", "For a solo instrument or small ensemble", "Often has three or four movements", "Popular in the Classical era", "Beethoven wrote many", "Sonata"
"A type of structure", "Used to cross a gap", "Can be made of wood, stone, or steel", "Connects two points over water or land", "Golden Gate is famous", "Bridge"
"A form of government", "Ruled by a single person", "Power is inherited", "Can be absolute or constitutional", "Kings and Queens often hold this position", "Monarchy"
"A scientific theory", "Explains the diversity of life", "Proposed by Charles Darwin", "Involves natural selection", "Suggests common ancestry", "Evolution"
"A large body of land", "Surrounded by water on most sides", "Can contain multiple countries", "Africa, Asia, Europe are examples", "Seven major ones on Earth", "Continent"
"A natural disaster", "Sudden shaking of the ground", "Caused by tectonic plate movement", "Can cause buildings to collapse", "Measured by Richter scale", "Earthquake"
"A type of energy", "Produced by splitting atoms", "Used in power plants", "Can be dangerous if uncontrolled", "Associated with bombs", "Nuclear Energy"
"A branch of philosophy", "Studies knowledge and belief", "Asks questions like 'How do we know what we know?'", "Plato and Aristotle contributed", "Focuses on the nature of reality", "Epistemology"
"A period of artistic flourishing", "Followed the Middle Ages", "Saw a revival of classical learning", "Began in Italy", "Da Vinci and Michelangelo were key figures", "Renaissance"
"A unit of currency", "Used in many European countries", "Introduced in 1999", "Symbol looks like an E", "Replaced francs, marks, and liras", "Euro"
"A type of star", "Very dense and small", "Remnant of a supernova", "Emits strong gravitational pull", "Can form a black hole", "Neutron Star"
"A form of communication", "Uses hand gestures and facial expressions", "Used by the deaf community", "Has its own grammar and syntax", "Varies by country", "Sign Language"
"A type of musical ensemble", "Features string, woodwind, brass, and percussion sections", "Led by a conductor", "Performs classical music", "Can be large or small", "Orchestra"
"A type of mathematical problem", "Involves finding a missing value", "Often uses variables like x and y", "Fundamental to algebra", "Requires solving equations", "Equation"
"A natural resource", "Formed from ancient plant and animal remains", "Burned for energy", "Contributes to climate change", "Coal, oil, natural gas are examples", "Fossil Fuel"
"A type of animal", "Can change its color to blend in", "Has a long, sticky tongue", "Eyes can move independently", "A type of lizard", "Chameleon"
"A field of study", "Examines human society and culture", "Includes anthropology, sociology, psychology", "Uses qualitative and quantitative methods", "Aims to understand human behavior", "Social Science"
"A type of structure", "Used for defense", "Often made of stone", "Has turrets and battlements", "Associated with medieval times", "Castle"
"A type of literary device", "A contrast between expectation and reality", "Can be verbal, situational, or dramatic", "Often used for comedic or tragic effect", "Sarcasm is a form of it", "Irony"
"A celestial body", "A small, rocky object orbiting the sun", "Smaller than a planet", "Many found in a belt between Mars and Jupiter", "Can sometimes hit Earth", "Asteroid"
"A type of art", "Involves carving or modeling materials", "Can be made of stone, wood, metal, or clay", "Three-dimensional", "Statues are examples", "Sculpture"
"A system of measurement", "Based on powers of ten", "Used worldwide for science", "Includes meters, grams, liters", "Simpler than imperial system", "Metric System"
"A type of chemical reaction", "Releases energy as heat or light", "Involves rapid oxidation", "Requires fuel, oxygen, and heat", "Used in engines and fireplaces", "Combustion"
"A historical period", "Followed the fall of the Western Roman Empire", "Often called the Dark Ages", "Lasted from 5th to 15th century", "Saw the rise of feudalism", "Middle Ages"
"A type of plant", "Does not have true roots, stems, or leaves", "Reproduces by spores", "Often grows in damp, shady places", "Moss and ferns are examples", "Non-Vascular Plant"
"A field of study", "Examines the human mind and behavior", "Includes cognitive, developmental, social branches", "Uses observation and experimentation", "Aims to understand mental processes", "Psychology"
"A type of weapon", "Used for long-range combat", "Fires projectiles with gunpowder", "Can be a rifle, pistol, or shotgun", "Requires training to use safely", "Firearm"
"A type of musical instrument", "Produces sound from vibrating strings", "Played with a bow or plucked", "Violin, cello, bass are examples", "Part of an orchestra", "String Instrument"
"A form of government", "Power is held by a small group of elites", "Rule by a few", "Can be based on wealth, military power, or family", "Ancient Sparta was an example", "Oligarchy"
"A natural phenomenon", "A large mass of ice moving slowly", "Forms over land from compacted snow", "Can carve out valleys", "Found in polar regions and high mountains", "Glacier"
"A type of literary work", "A short, fictional story", "Often teaches a moral lesson", "Features animals as characters", "Aesop is famous for them", "Fable"
"A scientific principle", "States that energy cannot be created or destroyed", "Only transformed from one form to another", "Fundamental to physics and chemistry", "Applies to closed systems", "Conservation of Energy"
"A type of animal", "Known for building dams", "Has a flat tail", "Semi-aquatic rodent", "Native to North America and Eurasia", "Beaver"
"A type of building", "Used for religious worship", "Can be a church, mosque, synagogue, or temple", "Often has unique architecture", "Place for prayer and community", "House of Worship"
"A type of art", "Involves creating images using light-sensitive materials", "Developed in the 19th century", "Can capture moments in time", "Digital versions are common today", "Photography"
"A celestial body", "A ball of hot, glowing gas", "Produces light and heat through nuclear fusion", "Our sun is one", "Many found in galaxies", "Star"
"A branch of science", "Studies the universe beyond Earth", "Includes stars, planets, galaxies", "Uses telescopes for observation", "Aims to understand cosmic phenomena", "Astronomy"
"A type of writing system", "Uses characters representing words or ideas", "Chinese and Japanese use it", "Can be complex to learn", "Differs from alphabetic systems", "Logographic System"
"A type of government", "Ruled by a single dictator", "Power is absolute and often oppressive", "Suppresses dissent", "North Korea is an example", "Dictatorship"
"A natural phenomenon", "A long period of abnormally low rainfall", "Causes water shortages and crop failure", "Can lead to famine", "Affects ecosystems", "Drought"
"A type of literary work", "A long narrative, typically fictional", "Often explores characters and plot in depth", "Can be historical, fantasy, or sci-fi", "Published as a book", "Novel"
"A scientific method", "A testable explanation for an observation", "Can be supported or refuted by evidence", "A starting point for scientific inquiry", "Must be falsifiable", "Hypothesis"
"A type of animal", "Known for its long neck and spots", "Tallest land animal", "Eats leaves from tall trees", "Native to Africa", "Giraffe"
"A type of building", "Used for public performances", "Often has a stage and seating", "Can host plays, concerts, or ballets", "Often ornate and grand", "Opera House"
"A type of energy", "Generated by the movement of water", "Used in hydroelectric power plants", "Renewable and clean", "Relies on dams and turbines", "Hydroelectric Power"
"A branch of science", "Studies living organisms", "Includes botany, zoology, ecology", "Examines life processes and interactions", "Uses observation and experimentation", "Biology"
"A type of structure", "Used to contain water", "Often built across rivers", "Generates electricity or controls floods", "Can be made of concrete or earth", "Dam"
"A type of literary device", "A figure of speech comparing two unlike things", "Uses 'like' or 'as'", "Adds vividness to writing", "Example: 'He is as strong as an ox'", "Simile"
"A type of animal", "A large marine reptile", "Known for its powerful jaws", "Lives in tropical and subtropical regions", "Can be saltwater or freshwater", "Crocodile"
"A type of weather phenomenon", "A severe snowstorm with strong winds", "Reduces visibility significantly", "Can cause whiteout conditions", "Dangerous for travel", "Blizzard"
"A field of study", "Examines past events and human societies", "Uses primary and secondary sources", "Aims to understand cause and effect", "Often involves research and interpretation", "History"
"A type of energy", "Generated from the Earth's internal heat", "Used in geothermal power plants", "Clean and renewable", "Accessed through hot springs or steam vents", "Geothermal Energy"
"A type of plant", "Has a thick, woody plant with a single main stem", "Produces leaves and branches", "Can live for many years", "Provides oxygen and shade", "Tree"
"A type of musical instrument", "Produces sound by blowing air through it", "Can be woodwind or brass", "Flute, trumpet, clarinet are examples", "Used in orchestras and bands", "Wind Instrument"
"A form of government", "Ruled by a king or queen", "Power is inherited", "Can be absolute or constitutional", "United Kingdom has one", "Monarchy"
"A celestial body", "A collection of stars, gas and dust", "Held together by gravity", "Our solar system is part of one", "Can be spiral, elliptical, or irregular", "Galaxy"
"A branch of science", "Studies the properties and behavior of matter and energy", "Includes mechanics, thermodynamics, electromagnetism", "Uses mathematical models", "Aims to understand fundamental laws of the universe", "Physics"
"A type of writing system", "Uses a set of letters to represent sounds", "English uses it", "Simpler than logographic systems", "Can be phonetic", "Alphabet"
"A natural phenomenon", "A large wave caused by underwater earthquakes or volcanic eruptions", "Can cause massive destruction on coastlines", "Travels across oceans", "Often mistaken for tidal waves", "Tsunami"
"A field of study", "Examines the production, distribution, and consumption of goods and services", "Studies scarcity and choice", "Includes microeconomics and macroeconomics", "Aims to understand markets and economies", "Economics"
"A type of literary work", "A play written for performance", "Involves dialogue and stage directions", "Can be a tragedy, comedy, or drama", "Performed in a theater", "Drama"
"A scientific law", "Describes a fundamental relationship in nature", "Always observed to be true under given conditions", "Often expressed as a mathematical equation", "Example: Newton's Laws of Motion", "Scientific Law"
"A type of animal", "A large, flightless bird", "Native to Australia", "Known for its long neck and legs", "Fast runner", "Emu"
"A type of building", "Used for higher education", "Students earn degrees here", "Has departments and faculties", "Often has a campus", "University"
"A type of energy", "Generated from the sun's rays", "Used in solar panels", "Clean and renewable", "Can power homes and businesses", "Solar Energy"
"A branch of science", "Studies the composition, structure, properties, and reactions of matter", "Includes organic, inorganic, physical branches", "Uses experiments to understand substances", "Aims to create new materials", "Chemistry"
"A type of structure", "Used for transportation over water", "Can be a boat, ship, or ferry", "Floats on water", "Used for travel, trade, or recreation", "Vessel"
"A type of literary device", "A figure of speech where a word or phrase is applied to an object or action to which it is not literally applicable", "Does not use 'like' or 'as'", "Example: 'The world is a stage'", "Adds imagery to writing", "Metaphor"
"A type of animal", "A large, powerful marine mammal", "Known for its tusks", "Lives in Arctic waters", "A type of seal", "Walrus"
"A type of weather phenomenon", "A visible mass of water droplets or ice crystals in the atmosphere", "Can be white or gray", "Indicates weather conditions", "Forms in various shapes", "Cloud"
"A field of study", "Examines the Earth's atmosphere and weather patterns", "Includes forecasting and climate science", "Uses data from satellites and radar", "Aims to predict weather", "Meteorology"
"A type of energy", "Generated from the wind", "Used in wind turbines", "Clean and renewable", "Harvested in windy areas", "Wind Energy"
"A type of plant", "A large, woody plant with a single main stem", "Produces leaves and branches", "Can live for many years", "Provides oxygen and shade", "Tree"
"A type of musical instrument", "Produces sound by striking it", "Includes drums, cymbals, xylophones", "Provides rhythm and texture", "Used in many genres of music", "Percussion Instrument"
`;

            // Hard CSV data (NEW from uploaded hard.csv and hard2.csv and hard3.csv) embedded directly in the JavaScript
            const hardCsvData = `
"Article", "Conjunction", "Intejection", "Noun", "Verb", "Parts of speech"
"Root", "Division", "Addition", "Subtraction", "Multiplication", "Mathematical operations"
"Family", "Decision", "Christmas", "Palm", "Barking up the wrong", "Words that come before tree"
"Semaphore", "Mailbox", "Soccer refree", "Pole in a golf hole", "Email marked as important", "Things with flags"
"Akbar (India)", "Cyrus (Persia)", "Frederick (Prussia)", "Catherine (Russia)", "Alexander (Macedonia)", "Rulers known as the Great"
"Victoria", "Regina", "Whitehorse", "Toronto", "Quebec City", "Canadian capitals"
"Watermelon", "Pumpkin", "Sunflower", "Bird feeder", "A strawberry's outside", "All have seeds"
"Pressure", "Control", "Oath", "Lock and key", "The weather (if you're sick)", "Words that come after under"
"Pay", "Zone", "A chord", "A bargain", "While the iron is hot", "Words that come after strike"
"Newton", "Rankine", "Kelvin", "Fahrenheit", "Celsius", "Temperature scales!"
"Chestnut", "Chocolate", "Sepia", "Burnt umber", "Mahogany", "Shades of brown"
"Henry", "Zidane", "Mbappé", "Ronaldo", "Messi", "Soccer/football stars"
"Fin", "Booster", "Payload system", "Nose cone", "Parachutes (for landings from space)", "Parts of a rocket"
"A group of stars", "Forms a recognizable pattern", "Often named after animals or mythological figures", "Ursa Major, Orion, Leo are examples", "Visible in the night sky", "Constellation"
"A type of rock", "Formed from cooled magma or lava", "Granite, basalt, obsidian are examples", "Can be intrusive or extrusive", "Often hard and crystalline", "Igneous Rock"
"A period of time", "Lasts for 100 years", "Often marked by significant historical events", "The 20th century, 21st century", "From Latin 'centum'", "Century"
"A scientific instrument", "Used to measure atmospheric pressure", "Helps predict weather changes", "Invented by Evangelista Torricelli", "Can be aneroid or mercury", "Barometer"
"A type of chemical bond", "Involves the sharing of electrons", "Forms molecules", "Strong and stable", "Water (H2O) has them", "Covalent Bond"
"A form of government", "Ruled by a small group of wealthy elites", "Power based on economic status", "Can lead to inequality", "Ancient Venice was an example", "Plutocracy"
"A literary device", "The use of an object or idea to represent something else", "Can be a person, place, or thing", "Often has a deeper meaning", "A dove representing peace", "Symbolism"
"A type of mathematical function", "Its graph is a U-shape", "Involves a squared variable (x^2)", "Used to model projectile motion", "Can have a vertex and axis of symmetry", "Quadratic Function"
"A natural phenomenon", "A large, destructive fire", "Spreads rapidly through forests or buildings", "Can be caused by lightning or human activity", "Difficult to control", "Wildfire"
"A field of study", "Examines the origins and development of human language", "Includes phonetics, syntax, semantics", "Studies how languages change over time", "Aims to understand linguistic structures", "Linguistics"
"A type of animal", "A large, flightless bird", "Native to South America", "Known for its long legs and neck", "Similar to an ostrich but smaller", "Rhea"
"A type of building", "Used for performing scientific experiments", "Often found in schools or research institutions", "Has specialized equipment and safety protocols", "Can be wet or dry", "Laboratory"
"A type of energy", "Produced by the decay of radioactive isotopes", "Used in nuclear power plants", "Can be dangerous if uncontrolled", "Associated with bombs", "Nuclear Fission"
"A branch of philosophy", "Studies the nature of moral principles", "Asks questions about right and wrong", "Includes deontology, utilitarianism, virtue ethics", "Guides human behavior", "Ethics"
"A historical period", "The period of European history from the 14th to the 17th century", "Marked by a renewed interest in classical art and learning", "Followed the Middle Ages", "Led to major scientific and artistic advancements", "Renaissance"
"A unit of time", "Equal to 1,000 years", "Often used in historical contexts", "The first millennium, second millennium", "From Latin 'mille'", "Millennium"
"A type of star", "A very dense and compact stellar remnant", "Formed from the core of a massive star after a supernova", "Has immense gravitational pull", "Can be a source of X-rays", "Neutron Star"
"A form of communication", "Uses a system of dots and dashes", "Transmitted via electrical signals or light", "Invented by Samuel Morse", "Used in telegraphy", "Morse Code"
"A type of musical form", "A large-scale musical composition for orchestra, chorus, and soloists", "Usually based on a sacred text", "Handel's Messiah is a famous example", "Performed in concerts or churches", "Oratorio"
"A type of mathematical curve", "Forms a symmetrical U-shape", "The graph of a quadratic equation", "Can open upwards or downwards", "Has a vertex and axis of symmetry", "Parabola"
"A natural resource", "A fossil fuel formed from ancient marine organisms", "Burned for energy", "Used to produce gasoline and plastics", "Extracted from underground reservoirs", "Petroleum"
"A type of animal", "A large, flightless bird", "Native to New Zealand", "Nocturnal and shy", "Has long whiskers and a long beak", "Kiwi"
"A field of study", "Examines the interaction between living organisms and their environment", "Includes ecosystems, populations, communities", "Studies energy flow and nutrient cycling", "Aims to understand biodiversity", "Ecology"
"A type of structure", "A fortified building or complex", "Used for defense against attack", "Often has thick walls, towers, and a moat", "Associated with medieval warfare", "Fortress"
"A literary device", "A statement that appears self-contradictory but contains a deeper truth", "Example: 'Less is more'", "Challenges conventional wisdom", "Often used in poetry and philosophy", "Paradox"
"A celestial body", "A small, irregularly shaped body orbiting the Sun", "Composed of ice, dust, and rock", "Develops a tail when near the Sun", "Halley's is famous", "Comet"
"A type of art", "A two-dimensional representation of a subject", "Created using paint, charcoal, or other media", "Can be realistic, abstract, or impressionistic", "Displayed on walls or canvases", "Drawing"
"A system of measurement", "Based on the foot, pound, and second", "Used primarily in the United States", "Less common globally than the metric system", "Has units like miles, gallons, ounces", "Imperial System"
"A type of chemical reaction", "Absorbs energy from its surroundings, causing cooling", "Requires an input of heat", "Example: instant cold packs", "Opposite of exothermic", "Endothermic Reaction"
"A historical period", "The period following the Renaissance", "Characterized by scientific and intellectual advancements", "Emphasized reason and individualism", "Led to revolutions in thought and society", "Enlightenment"
`;

            // Ultra CSV data (NEW) embedded directly in the JavaScript
            const ultraCsvData = `
"A quantum mechanical phenomenon", "Particles can exist in multiple states simultaneously", "Collapses to a single state upon observation", "Schrödinger's cat thought experiment", "Fundamental to quantum computing", "Superposition"
"A mathematical concept", "Represents an infinitely long decimal expansion", "Ratio of a circle's circumference to its diameter", "Approximately 3.14159", "Used in geometry and trigonometry", "Pi"
"A philosophical problem", "Concerns the relationship between mind and body", "Asks how mental states relate to physical states", "Dualism vs. Monism", "Descartes contributed to it", "Mind-Body Problem"
"A psychological phenomenon", "Tendency to interpret new evidence as confirmation of one's existing beliefs", "Leads to biased information processing", "Can affect decision-making", "Often seen in political discourse", "Confirmation Bias"
"A scientific principle", "States that a system tends toward increasing disorder over time", "Second law of thermodynamics", "Applies to isolated systems", "Explains why things break down", "Entropy"
"A linguistic phenomenon", "The study of the historical development of language", "Examines changes in sounds, grammar, and vocabulary", "Reconstructs ancient languages", "Indo-European is a major family", "Historical Linguistics"
"A celestial object", "A region of spacetime where gravity is so strong that nothing can escape", "Forms from the collapse of massive stars", "Has an event horizon", "Can be supermassive at galaxy centers", "Black Hole"
"A mathematical structure", "A set of points and connections between them", "Used to model networks and relationships", "Includes nodes and edges", "Used in computer science and social networks", "Graph Theory"
"A philosophical school of thought", "Emphasizes the individual's existence, freedom, and responsibility", "Focuses on subjective experience", "Kierkegaard, Nietzsche, Sartre were proponents", "Often associated with anxiety and dread", "Existentialism"
"A cognitive bias", "Tendency to overestimate one's own abilities", "Often seen in unskilled individuals", "Causes overconfidence", "Named after a study of bank robbers", "Dunning-Kruger Effect"
"A scientific theory", "Describes the large-scale structure and evolution of the universe", "States that the universe began from a hot, dense state", "Supported by cosmic microwave background radiation", "Led to the expansion of space", "Big Bang Theory"
"A literary movement", "Emphasized emotion, individualism, and glorification of nature", "Reacted against Enlightenment rationalism", "Late 18th to mid-19th century", "Wordsworth, Byron, Shelley were proponents", "Romanticism"
"A mathematical concept", "A function that is its own derivative", "Used to model exponential growth or decay", "Base is Euler's number (e)", "Appears in calculus and complex analysis", "Exponential Function"
"A type of currency", "A decentralized digital currency", "Uses cryptography for security", "Operates on a blockchain", "First created by Satoshi Nakamoto", "Bitcoin"
"A philosophical concept", "The inherent meaninglessness of life", "Often associated with existentialism", "Camus wrote about it in 'The Myth of Sisyphus'", "Can lead to despair or rebellion", "Absurdism"
"A scientific principle", "States that the total momentum of a system remains constant if no external forces act on it", "Applies to collisions and explosions", "Fundamental to classical mechanics", "Related to Newton's third law", "Conservation of Momentum"
"A type of logical fallacy", "Assuming that because two events occurred together, one caused the other", "Correlation does not imply causation", "Often misused in arguments", "Example: 'Ice cream sales increase with crime rates'", "False Cause"
"A branch of physics", "Studies the behavior of matter and light at the atomic and subatomic level", "Developed in the early 20th century", "Includes concepts like wave-particle duality", "Heisenberg's uncertainty principle is central", "Quantum Mechanics"
"A type of artistic technique", "Creates an illusion of three-dimensionality on a two-dimensional surface", "Uses perspective and shading", "Developed during the Renaissance", "Leonardo da Vinci was a master", "Chiaroscuro"
"A philosophical concept", "The idea that all events are predetermined", "No free will", "Can be theological or scientific", "Opposite of libertarianism", "Determinism"
"A mathematical concept", "A sequence where each number is the sum of the two preceding ones", "Starts with 0 and 1", "Appears in nature and art (e.g., golden ratio)", "Named after an Italian mathematician", "Fibonacci Sequence"
"A type of legal system", "Based on judicial precedent rather than codified laws", "Originated in England", "Used in many former British colonies", "Judges interpret laws based on past rulings", "Common Law"
"A cognitive bias", "Tendency to rely too heavily on the first piece of information offered", "Influences subsequent judgments", "Can affect negotiations and pricing", "Often used in sales tactics", "Anchoring Bias"
"A scientific field", "Studies the origin, evolution, and fate of the universe", "Includes the Big Bang, dark matter, dark energy", "Combines astronomy and physics", "Aims to understand the cosmos", "Cosmology"
"A literary genre", "Characterized by a bleak or dystopian future", "Often explores themes of technological control or societal decay", "Huxley's 'Brave New World' is an example", "Often critical of modern society", "Dystopian Fiction"
"A type of logical argument", "Moves from specific observations to a general conclusion", "Used in scientific research", "Conclusions are probable, not certain", "Opposite of deduction", "Inductive Reasoning"
"A philosophical problem", "Asks whether artificial intelligence can truly think or have consciousness", "Turing Test is a famous proposal", "Concerns the nature of intelligence", "Searle's Chinese Room argument is relevant", "Strong AI Problem"
"A mathematical concept", "A measure of the likelihood of an event occurring", "Expressed as a number between 0 and 1", "Used in statistics and risk assessment", "Can be theoretical or experimental", "Probability"
"A type of artistic movement", "Emphasized subjective experience and emotional expression", "Distorted reality to convey inner feelings", "Early 20th century Germany", "Artists like Edvard Munch", "Expressionism"
"A scientific principle", "States that every action has an equal and opposite reaction", "Third law of motion", "Applies to forces between interacting objects", "Explains propulsion", "Newton's Third Law"
"A philosophical school of thought", "Emphasizes the idea that value is subjective", "Argues that moral truths are not objective", "Often associated with postmodernism", "Can lead to relativism", "Nihilism"
"A mathematical concept", "A non-Euclidean geometry", "Deals with curved spaces", "Used in Einstein's theory of relativity", "Contrasts with flat Euclidean geometry", "Riemannian Geometry"
"A historical event", "The widespread technological and industrial advancement from the 18th to 19th centuries", "Saw the invention of the steam engine and textile machinery", "Led to urbanization and new social classes", "Transformed economies and societies", "Industrial Revolution"
"A cognitive bias", "Tendency to see patterns or connections in random or meaningless data", "Can lead to superstitious beliefs", "Often observed in gamblers", "Example: seeing faces in clouds", "Apophenia"
"A field of study", "Examines the characteristics and distribution of human populations", "Includes birth rates, death rates, migration", "Uses statistical methods", "Aims to understand population changes", "Demography"
"A type of literary work", "A narrative within a narrative", "A story told by a character within another story", "Often provides a different perspective or context", "Frankenstein uses this technique", "Frame Story"
"A scientific principle", "States that the universe is homogeneous and isotropic on large scales", "No special center or edge", "Fundamental to modern cosmology", "Supports the Big Bang theory", "Cosmological Principle"
"A type of animal behavior", "A fixed, unlearned pattern of behavior", "Triggered by specific stimuli", "Cannot be modified by learning", "Example: spider web spinning", "Instinct"
"A philosophical concept", "The theory that all events are ultimately determined by causes external to the will", "Often used to argue against free will", "Can be hard or soft", "Related to fate and destiny", "Determinism"
"A mathematical concept", "The limit of a function as the independent variable approaches a certain value", "Fundamental to calculus", "Used to define continuity and derivatives", "Can be finite or infinite", "Limit"
"A type of government", "Ruled by a single religious leader or institution", "Laws based on religious texts", "Often seen in ancient societies", "Iran has elements of this", "Theocracy"
"A historical event", "The period of political and social upheaval in France from 1789 to 1799", "Overthrew the monarchy and established a republic", "Led to the rise of Napoleon", "Influenced subsequent revolutions", "French Revolution"
"A type of cognitive bias", "Tendency to search for, interpret, favor, and recall information that confirms one's beliefs", "Ignoring contradictory evidence", "Strengthens existing opinions", "Contributes to polarization", "Confirmation Bias"
"A scientific field", "Studies ancient life forms through fossils", "Examines prehistoric plants and animals", "Helps reconstruct Earth's past ecosystems", "Works closely with geology", "Paleontology"
"A literary device", "A reference to a person, place, event, or literary work", "Assumes the audience has prior knowledge", "Adds depth and meaning to text", "Can be biblical, mythological, or historical", "Allusion"
"A type of celestial object", "A massive star that has exhausted most of its nuclear fuel", "Undergoes a catastrophic explosion", "Can outshine an entire galaxy for a time", "Leaves behind a neutron star or black hole", "Supernova"
"A philosophical problem", "Asks if consciousness is merely a product of physical processes in the brain", "Debate between materialists and dualists", "Challenges our understanding of self", "Related to the hard problem of consciousness", "Hard Problem of Consciousness"
"A mathematical concept", "A collection of distinct objects or elements", "Can be finite or infinite", "Used in set theory and logic", "Union, intersection, complement are operations", "Set"
"A form of communication", "Uses a formal system of signs, sounds, or gestures", "Governed by grammatical rules", "Used by humans for complex thought and expression", "English, Spanish, Chinese are examples", "Language"
"A historical period", "A time of great innovation and social change in Europe during the 17th and 18th centuries", "Emphasized reason, science, and individualism", "Challenged traditional authority", "Influenced by thinkers like Locke and Rousseau", "Age of Enlightenment"
"A type of cognitive bias", "Tendency for individuals to work less hard in a group than they would individually", "Reduced accountability in larger groups", "Can impact team productivity", "Also known as free-riding", "Social Loafing"
"A scientific principle", "States that the observed universe appears roughly the same in all directions", "Supports the idea of a homogeneous and isotropic universe", "Fundamental to modern cosmology", "Used to extrapolate observations", "Isotropy"
"A literary genre", "A fictional narrative that explores themes of science and technology", "Often set in the future or on other planets", "Features advanced gadgets, space travel, AI", "Ray Bradbury, Isaac Asimov are famous authors", "Science Fiction"
"A type of government", "Ruled by a few individuals based on their wealth or property ownership", "Power held by the rich", "Can lead to corruption and inequality", "Often contrasts with democracy", "Plutocracy"
"A mathematical concept", "A measure of the dispersion of a set of data points around their mean", "Indicates how spread out numbers are", "Used in statistics and probability", "Square root of variance", "Standard Deviation"
"A philosophical problem", "Explores the nature of existence, being, and reality", "One of the fundamental branches of metaphysics", "Asks questions like 'What is real?'", "Heidegger and Aristotle were proponents", "Ontology"
"A scientific field", "Studies the properties and interactions of matter and energy", "Fundamental science", "Includes mechanics, thermodynamics, electromagnetism, quantum mechanics", "Aims to understand the universe", "Physics"
"A type of historical source", "An original document or artifact from the time period being studied", "Diaries, letters, photographs, eyewitness accounts are examples", "Provides direct evidence", "Essential for historical research", "Primary Source"
"A literary device", "The use of clues or hints to suggest events that will occur later in the story", "Creates suspense and anticipation", "Often subtle or overt", "Builds up to a climax", "Foreshadowing"
"A type of celestial object", "A small, irregularly shaped body orbiting a planet or star", "Often a captured asteroid or debris", "Mars has two, Phobos and Deimos", "Can be artificial or natural", "Moon (natural satellite)"
"A mathematical concept", "A set of values that can be mapped to another set of values", "Each input has exactly one output", "Used in algebra and calculus", "Can be one-to-one or onto", "Function"
"A philosophical school of thought", "Believes that knowledge is primarily derived from sensory experience", "Emphasizes observation and experimentation", "Locke, Berkeley, Hume were proponents", "Opposite of rationalism", "Empiricism"
"A type of chemical reaction", "A chemical process that releases heat into its surroundings", "Causes a rise in temperature", "Combustion is a common example", "Opposite of endothermic", "Exothermic Reaction"
"A historical period", "The period of renewed interest in classical culture and learning in Europe during the 14th to 17th centuries", "Marked by a shift from religious to secular thought", "Led to new art, science, and literature", "Began in Italy", "Renaissance"
"A cognitive bias", "Tendency to favor information that confirms one's existing beliefs", "Ignoring contradictory evidence", "Leads to biased decision-making", "Can be conscious or unconscious", "Confirmation Bias"
"A scientific principle", "States that the oldest layers of rock are at the bottom and the youngest are at the top", "Used to determine the relative ages of rock strata", "Fundamental to stratigraphy", "Proposed by Nicolas Steno", "Law of Superposition"
"A type of animal", "A marine mammal known for its intelligence", "Has a blowhole on its head", "Uses echolocation to navigate", "Often seen in pods", "Dolphin"
"A field of study", "Examines the Earth's physical features and human activities", "Includes physical and human branches", "Studies landscapes, populations, climate", "Uses maps and spatial analysis", "Geography"
"A literary device", "The use of words to convey a meaning that is the opposite of its literal meaning", "Can be verbal, situational, or dramatic", "Often used for humor or satire", "Sarcasm is a common form", "Irony"
"A type of celestial object", "A small, icy body that orbits the Sun", "Often classified as a dwarf planet or small solar system body", "Pluto is one", "Located beyond Neptune in the Kuiper Belt", "Trans-Neptunian Object"
"A mathematical concept", "A vector space equipped with a norm that induces a metric", "A complete normed vector space", "Fundamental in functional analysis", "Named after a Polish mathematician", "Banach Space"
"A philosophical problem", "Asks whether moral judgments are objective truths or subjective preferences", "Debate between moral realists and anti-realists", "Concerns the foundation of ethics", "Influences legal and political theory", "Meta-ethics"
"A scientific field", "Studies the structure, properties, and reactions of chemical substances", "Central science", "Includes organic, inorganic, physical and analytical branches", "Aims to understand matter", "Chemistry"
"A historical period", "The period of technological and cultural progress during the 19th and early 20th centuries", "Saw the invention of electricity, telephone, automobile", "Followed the Industrial Revolution", "Led to widespread modernization", "Second Industrial Revolution"
"A type of cognitive bias", "Tendency to believe that one has foreseen an event after it has occurred", "The 'I knew it all along' effect", "Can affect memory and decision-making", "Makes past events seem more predictable", "Hindsight Bias"
"A literary genre", "A fictional work set in a historical period", "Combines historical facts with fictional characters or events", "Often explores real events through personal stories", "Walter Scott is considered a pioneer", "Historical Fiction"
"A scientific principle", "States that a living organism's genotype is inherited, but its phenotype is influenced by both genetics and environment", "Explains individual differences", "Nature vs. Nurture debate", "Fundamental to genetics", "Genotype-Phenotype Distinction"
"A type of animal", "A marine reptile with a hard shell", "Spends most of its life in the ocean", "Lays eggs on beaches", "Can be green, loggerhead, or leatherback", "Sea Turtle"
"A field of study", "Examines the structures and processes of the human body", "Includes anatomy, physiology, histology", "Studies how the body functions", "Essential for medicine and health sciences", "Human Physiology"
"A type of art", "A style that uses distortion and exaggeration for emotional effect", "Often depicts a subjective reality", "Famous artists include Van Gogh and Picasso", "Precursor to abstract art", "Expressionism"
"A philosophical concept", "The theory that sensory experience is the ultimate source of all knowledge", "Emphasizes empirical evidence", "John Locke and David Hume were proponents", "Contrasts with rationalism", "Empiricism"
"A mathematical concept", "A sequence of numbers in which each term after the first is found by multiplying the previous one by a fixed, non-zero number", "Example: 2, 4, 8, 16...", "Used in financial calculations", "Has a common ratio", "Geometric Progression"
"A type of legal system", "A legal tradition that originated in ancient Rome", "Based on written codes and statutes", "Used in many European and Latin American countries", "Judges apply codified laws rather than precedent", "Civil Law"
"A cognitive bias", "Tendency to think that others agree with your opinions more than they actually do", "Overestimating the commonality of one's own beliefs", "Can lead to groupthink", "Contributes to false consensus", "False Consensus Effect"
"A scientific field", "Studies ancient human societies through archaeological excavation and artifact analysis", "Reconstructs past cultures and behaviors", "Works closely with anthropology", "Examines material remains", "Archaeology"
"A type of literary work", "A narrative poem that tells a story, often about heroes or historical events", "Longer than a ballad", "Can be epic or lyric", "Often sung or recited", "Narrative Poem"
"A celestial object", "A star in the final stages of its life cycle", "Has collapsed to a very dense state", "Emits light but no longer fuses hydrogen", "Can be a white dwarf, neutron star, or black hole", "Stellar Remnant"
"A philosophical problem", "Asks whether knowledge is possible", "Examines the nature and limits of human understanding", "Skepticism is a prominent viewpoint", "Central to epistemology", "Problem of Knowledge"
"A mathematical concept", "A number that can be expressed as a fraction p/q of two integers", "Cannot be expressed as a simple fraction (e.g., pi, square root of 2)", "Its decimal representation is non-repeating and non-terminating", "Contrasts with rational numbers", "Irrational Number"
"A type of government", "Ruled by a small group of individuals who hold power through force or wealth", "Often characterized by corruption and self-interest", "Contrasts with democracy or aristocracy", "Can be a military junta", "Oligarchy (Plutocracy or Junta)"
`;

            // Function to load the CSV data from the embedded string
            function loadCSVData(csvString) {
                try {
                    const uniqueRows = new Set();
                    const parsedData = [];

                    csvString.trim().split('\n').forEach(row => {
                        const cells = row.match(/(?:[^,"']+|"[^"]*")+/g);
                        if (cells && cells.length === 6) {
                            const processedCells = cells.map(cell => cell.trim().replace(/^"|"$/g, ''));
                            const answer = processedCells[5];
                            let isValidRow = true;

                            // Check if any clue contains the answer
                            for (let i = 0; i < 5; i++) {
                                // Normalize both clue and answer for the check
                                if (normalizeString(processedCells[i]).includes(normalizeString(answer)) && normalizeString(answer).length > 2) {
                                    console.warn(`Discarding row (clue contains answer): ${row}`);
                                    isValidRow = false;
                                    break;
                                }
                            }

                            if (isValidRow) {
                                const rowKey = processedCells.join('|'); // Create a unique key for the row
                                if (!uniqueRows.has(rowKey)) {
                                    uniqueRows.add(rowKey);
                                    parsedData.push(processedCells);
                                } else {
                                    console.warn(`Discarding duplicate row: ${row}`);
                                }
                            }
                        } else {
                             console.warn(`Discarding malformed row: ${row}`);
                        }
                    });
                    gameData = parsedData;
                    startGame();
                }
                catch (error) {
                    console.error('Error parsing game data:', error);
                    messageDisplay.textContent = 'Failed to parse game data. Please ensure the embedded data is correctly formatted.';
                    submitGuessButton.disabled = true;
                    guessInput.disabled = true;
                }
            }

            // Function to start a new game
            function startGame() {
                if (gameData.length === 0) {
                    messageDisplay.textContent = 'No game data available for this difficulty. Please select a difficulty.';
                    return;
                }

                stopConfetti();
                confettiContainer.innerHTML = '';
                stopSadEmojis();
                stopHappyEmojis();
                emojiContainer.innerHTML = '';
                stopBalloons(); // Stop balloons
                balloonContainer.innerHTML = ''; // Clear balloons

                // Stop any running timer
                clearInterval(timerInterval);
                timerDisplay.classList.add('hidden'); // Hide timer by default

                body.classList.remove('correct-bg', 'incorrect-bg');

                currentClueIndex = 0;
                messageDisplay.textContent = '';
                incorrectGuessesDisplay.innerHTML = '';
                playAgainButton.classList.add('hidden');
                submitGuessButton.classList.remove('hidden');
                submitGuessButton.disabled = false;
                guessInput.disabled = false;
                guessInput.value = '';

                document.querySelectorAll('#clueTable tbody tr').forEach(row => {
                    row.classList.add('hidden');
                    row.classList.remove('shake');
                    row.classList.remove('correct-clue-revealed');
                    row.classList.remove('lost-game'); // Ensure lost-game class is removed
                });

                let newRandomIndex;
                if (gameData.length > 1) {
                    do {
                        newRandomIndex = Math.floor(Math.random() * gameData.length);
                    } while (newRandomIndex === lastUsedGameIndex);
                } else {
                    newRandomIndex = 0; // If only one item, just pick it
                }
                lastUsedGameIndex = newRandomIndex; // Update the last used index
                currentRow = gameData[newRandomIndex];

                for (let i = 1; i <= maxClues; i++) {
                    document.getElementById(`clue${i}`).textContent = currentRow[i - 1];
                }
                document.getElementById('answer').textContent = currentRow[maxClues];

                revealNextClue();

                // Start timer if Ultra difficulty is selected
                if (currentDifficulty === 'ultra') {
                    startTimer();
                }
            }

            // Function to reveal the next clue
            function revealNextClue() {
                if (currentClueIndex < maxClues) {
                    currentClueIndex++;
                    document.getElementById(`clue${currentClueIndex}-row`).classList.remove('hidden');
                } else {
                    // This 'else' block is intentionally left empty.
                    // The game over logic for running out of clues is now handled
                    // exclusively within the checkGuess function.
                }
                guessInput.focus();
            }

            // Function to check the player's guess
            function checkGuess() {
                const playerGuess = guessInput.value.trim();
                const correctAnswer = currentRow[maxClues].replace(/^"|"$/g, '').trim(); // Get raw correct answer
                
                // Input validation: if guess is empty, shake input box and return
                if (playerGuess === '') {
                    messageDisplay.textContent = 'Please enter a guess.';
                    guessInput.classList.add('shake');
                    setTimeout(() => {
                        guessInput.classList.remove('shake');
                        messageDisplay.textContent = ''; // Clear message after shake
                    }, 600); // Match shake animation duration
                    return; // Stop function execution
                }

                if (isSimilarAnswer(playerGuess, correctAnswer)) { // Use the new similarity check
                    messageDisplay.textContent = 'Correct! You got it!';
                    submitGuessButton.disabled = true;
                    guessInput.disabled = true;
                    submitGuessButton.classList.add('hidden');

                    clearInterval(timerInterval); // Stop timer on correct guess
                    if (currentDifficulty === 'ultra') {
                        timerDisplay.classList.remove('red-text');
                        timerDisplay.classList.add('blue-text'); // Timer turns blue on win
                        startBalloons(); // Start balloons for Ultra win
                    }

                    for (let i = 1; i <= currentClueIndex; i++) {
                        document.getElementById(`clue${i}-row`).classList.add('correct-clue-revealed');
                    }

                    revealAnswer(true);
                    playAgainButton.classList.remove('hidden');
                    startConfetti();
                    startHappyEmojis();
                    body.classList.remove('incorrect-bg');
                    body.classList.add('correct-bg');
                } else {
                    messageDisplay.textContent = 'Incorrect guess. Try again!';
                    guessInput.value = '';
                    incorrectGuessesDisplay.innerHTML += `<del>${playerGuess}</del> `;
                    shakeTable();
                    setTimeout(() => {
                        messageDisplay.textContent = '';
                        // Determine if this was the final guess opportunity (after clue 5 is revealed)
                        const isFinalGuessAttempt = (currentClueIndex === maxClues);

                        if (isFinalGuessAttempt) {
                            // If it was the 5th clue and they got it wrong, it's game over
                            messageDisplay.textContent = `Game Over! The answer was: "${currentRow[maxClues]}"`;
                            submitGuessButton.disabled = true;
                            guessInput.disabled = true;
                            submitGuessButton.classList.add('hidden');
                            revealAnswer(false); // Show all clues and answer
                            playAgainButton.classList.remove('hidden');
                            startSadEmojis();
                            body.classList.remove('correct-bg');
                            body.classList.add('incorrect-bg');
                            document.getElementById('answer-row').classList.add('lost-game'); // Apply lost-game class here
                        } else {
                            // Otherwise, reveal the next clue
                            revealNextClue();
                        }
                    }, 600);
                }
            }

            // Function to shake the table
            function shakeTable() {
                const table = document.getElementById('clueTable');
                table.classList.add('shake');
                setTimeout(() => {
                    table.classList.remove('shake');
                }, 500);
            }

            // Function to reveal all clues and the answer
            function revealAnswer(isCorrectGuess) {
                for (let i = 1; i <= maxClues; i++) {
                    document.getElementById(`clue${i}-row`).classList.remove('hidden');
                }
                document.getElementById('answer-row').classList.remove('hidden');
                submitGuessButton.classList.add('hidden');
                
                // If the player wins before the timer runs out, and it's Ultra difficulty,
                // the timer should stop and be red. This is handled slightly differently if timer runs out vs win.
                if (currentDifficulty === 'ultra' && !isCorrectGuess && timeLeft > 0) {
                     clearInterval(timerInterval);
                     timerDisplay.classList.remove('blue-text');
                     timerDisplay.classList.add('red-text');
                }
            }

            // Confetti functions
            function getRandomColor() {
                const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722', '#795548', '#9E9E9E', '#607D8B'];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            function createConfetti() {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.backgroundColor = getRandomColor();

                const startX = Math.random() * window.innerWidth;
                const startY = -20;
                const endX = startX + (Math.random() - 0.5) * 400;
                const endY = window.innerHeight + 20;

                confetti.style.setProperty('--x', `${startX}px`);
                confetti.style.setProperty('--y', `${startY}px`);
                confetti.style.setProperty('--x-end', `${endX}px`);
                confetti.style.setProperty('--y-end', `${endY}px`);

                confettiContainer.appendChild(confetti);
                confetti.addEventListener('animationend', () => {
                    confetti.remove();
                });
            }

            function startConfetti() {
                stopConfetti();
                confettiInterval = setInterval(() => {
                    for (let i = 0; i < 10; i++) {
                        createConfetti();
                    }
                }, 100);
                setTimeout(() => {
                    stopConfetti();
                }, 3000);
            }

            function stopConfetti() {
                if (confettiInterval) {
                    clearInterval(confettiInterval);
                    confettiInterval = null;
                }
            }

            // Sad Emoji functions
            function createSadEmoji() {
                const emojis = ['😞', '😭', '👎']; // Sad face, crying face, and thumbs down emojis
                const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];

                const emoji = document.createElement('div');
                emoji.classList.add('emoji');
                emoji.textContent = randomEmoji;

                const startX = Math.random() * window.innerWidth;
                const startY = -20;
                const endX = startX + (Math.random() - 0.5) * 400;
                const endY = window.innerHeight + 20;

                emoji.style.setProperty('--x', `${startX}px`);
                emoji.style.setProperty('--y', `${startY}px`);
                emoji.style.setProperty('--x-end', `${endX}px`);
                emoji.style.setProperty('--y-end', `${endY}px`);

                emojiContainer.appendChild(emoji);
                emoji.addEventListener('animationend', () => {
                    emoji.remove();
                });
            }

            function startSadEmojis() {
                stopSadEmojis();
                sadEmojiInterval = setInterval(() => {
                    for (let i = 0; i < 5; i++) {
                        createSadEmoji();
                    }
                }, 150);
                setTimeout(() => {
                    stopSadEmojis();
                }, 3000);
            }

            function stopSadEmojis() {
                if (sadEmojiInterval) {
                    clearInterval(sadEmojiInterval);
                    sadEmojiInterval = null;
                }
            }

            // Happy Emoji functions
            function createHappyEmoji() {
                const emojis = ['😊', '😄', '🥳', '👍']; // Happy face emojis and thumbs up emoji
                const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];

                const emoji = document.createElement('div');
                emoji.classList.add('emoji');
                emoji.textContent = randomEmoji;

                const startX = Math.random() * window.innerWidth;
                const startY = -20;
                const endX = startX + (Math.random() - 0.5) * 400;
                const endY = window.innerHeight + 20;

                emoji.style.setProperty('--x', `${startX}px`);
                emoji.style.setProperty('--y', `${startY}px`);
                emoji.style.setProperty('--x-end', `${endX}px`);
                emoji.style.setProperty('--y-end', `${endY}px`);

                emojiContainer.appendChild(emoji);
                emoji.addEventListener('animationend', () => {
                    emoji.remove();
                });
            }

            function startHappyEmojis() {
                stopHappyEmojis();
                happyEmojiInterval = setInterval(() => {
                    for (let i = 0; i < 5; i++) {
                        createHappyEmoji();
                    }
                }, 150);
                setTimeout(() => {
                    stopHappyEmojis();
                }, 3000);
            }

            function stopHappyEmojis() {
                if (happyEmojiInterval) {
                    clearInterval(happyEmojiInterval);
                    happyEmojiInterval = null;
                }
            }

            // Balloon functions
            function createBalloon() {
                const balloon = document.createElement('div');
                balloon.classList.add('balloon');
                balloon.style.backgroundColor = getRandomColor();

                // Randomly decide to come from left or right
                const fromLeft = Math.random() < 0.5;
                let startX, endX;
                const startY = Math.random() * window.innerHeight; // Y position within viewport
                const endY = Math.random() * window.innerHeight; // Y position within viewport

                if (fromLeft) {
                    startX = -50; // Start off-screen left
                    endX = window.innerWidth + 50; // End off-screen right
                } else {
                    startX = window.innerWidth + 50; // Start off-screen right
                    endX = -50; // End off-screen left
                }
                
                const rotateStart = Math.random() * 360 - 180; // Random initial rotation
                const rotateEnd = rotateStart + (Math.random() * 720 - 360); // Random end rotation

                balloon.style.setProperty('--x-start', `${startX}px`); // Use x-start
                balloon.style.setProperty('--y', `${startY}px`); // Use y for consistent vertical start
                balloon.style.setProperty('--x-end', `${endX}px`);
                balloon.style.setProperty('--y-end', `${endY}px`); // Use y-end for consistent vertical end
                balloon.style.setProperty('--rotate-start', `${rotateStart}deg`);
                balloon.style.setProperty('--rotate-end', `${rotateEnd}deg`);

                balloonContainer.appendChild(balloon);

                balloon.addEventListener('animationend', () => {
                    balloon.remove();
                });
            }

            function startBalloons() {
                stopBalloons();
                balloonInterval = setInterval(() => {
                    for (let i = 0; i < 3; i++) { // Create a few balloons at a time
                        createBalloon();
                    }
                }, 300); // Create new balloons every 300ms

                // Stop balloons after a few seconds (e.g., 4 seconds)
                setTimeout(() => {
                    stopBalloons();
                }, 4000);
            }

            function stopBalloons() {
                if (balloonInterval) {
                    clearInterval(balloonInterval);
                    balloonInterval = null;
                }
            }

            // Timer functions for Ultra difficulty
            function startTimer() {
                timerDisplay.classList.remove('hidden');
                timeLeft = ULTRA_TIME_LIMIT;
                timeRemainingSpan.textContent = `Seconds left: ${timeLeft}`; // Update the span with text and number
                timerDisplay.classList.remove('hidden'); // Show timer
                timerDisplay.classList.remove('blue-text', 'red-text'); // Remove old color classes
                timeRemainingSpan.style.color = 'gray'; // Start numerical part as gray

                timerInterval = setInterval(() => {
                    timeLeft--;
                    timeRemainingSpan.textContent = `Seconds left: ${timeLeft}`; // Update the span with text and number

                    // Color transition from gray (rgb(128,128,128)) to red (rgb(255,0,0))
                    // As timeLeft goes from 30 to 0, red component goes from 128 to 255, green/blue go from 128 to 0
                    const redComponent = Math.min(255, 128 + Math.floor((ULTRA_TIME_LIMIT - timeLeft) / ULTRA_TIME_LIMIT * 127)); // 128 to 255
                    const greenBlueComponent = Math.max(0, 128 - Math.floor((ULTRA_TIME_LIMIT - timeLeft) / ULTRA_TIME_LIMIT * 128)); // 128 to 0
                    timeRemainingSpan.style.color = `rgb(${redComponent}, ${greenBlueComponent}, ${greenBlueComponent})`;


                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        timeRemainingSpan.textContent = "Seconds left: 0"; // Final text for 0 seconds
                        timeRemainingSpan.style.color = 'red';
                        onTimerEnd();
                    }
                }, 1000); // Update every second
            }

            function onTimerEnd() {
                if (submitGuessButton.disabled) return; // Game already over (won or lost)

                messageDisplay.textContent = "You ran out of time!";
                submitGuessButton.disabled = true;
                guessInput.disabled = true;
                submitGuessButton.classList.add('hidden');
                
                revealAnswer(false); // Reveal answer even if out of time
                playAgainButton.classList.remove('hidden');
                startSadEmojis(); // Sad emojis for running out of time
                body.classList.remove('correct-bg');
                body.classList.add('incorrect-bg');
                document.getElementById('answer-row').classList.add('lost-game'); // Apply lost-game class
            }

            // Difficulty button handling
            function selectDifficulty(difficulty) {
                easyButton.classList.remove('selected');
                mediumButton.classList.remove('selected');
                hardButton.classList.remove('selected');
                ultraButton.classList.remove('selected'); // Remove selected from Ultra

                // Stop any existing timer or animations when changing difficulty
                clearInterval(timerInterval);
                // --- CORRECTED FIX START ---
                timerDisplay.classList.add('hidden'); // ALWAYS hide timer when changing difficulty
                // --- CORRECTED FIX END ---
                stopConfetti();
                stopHappyEmojis();
                stopSadEmojis();
                stopBalloons();

                currentDifficulty = difficulty; // Update current difficulty tracker

                if (difficulty === 'easy') {
                    easyButton.classList.add('selected');
                    loadCSVData(easyCsvData);
                    localStorage.setItem('gameDifficulty', 'easy');
                    location.reload();
                } else if (difficulty === 'medium') {
                    mediumButton.classList.add('selected');
                    loadCSVData(mediumCsvData);
                    localStorage.setItem('gameDifficulty', 'medium');
                    location.reload();
                } else if (difficulty === 'hard') {
                    hardButton.classList.add('selected');
                    loadCSVData(hardCsvData);
                    localStorage.setItem('gameDifficulty', 'hard');
                    location.reload();
                } else if (difficulty === 'ultra') { // Handle Ultra difficulty
                    ultraButton.classList.add('selected');
                    loadCSVData(ultraCsvData); // Load Ultra data
                    timerDisplay.classList.remove('hidden'); // Show timer only for Ultra
                    localStorage.setItem('gameDifficulty', 'ultra');
                    // REMOVE THIS LINE (it's redundant with the one above): timerDisplay.classList.remove('hidden');
                }
            }

            // Event Listeners
            submitGuessButton.addEventListener('click', checkGuess);
            guessInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter' && !submitGuessButton.disabled) {
                    checkGuess();
                }
            });
            playAgainButton.addEventListener('click', () => {
                // Reload the page, the DOMContentLoaded listener will pick up the stored difficulty
                location.reload();
            });

            easyButton.addEventListener('click', () => selectDifficulty('easy'));
            mediumButton.addEventListener('click', () => selectDifficulty('medium'));
            hardButton.addEventListener('click', () => selectDifficulty('hard'));
            ultraButton.addEventListener('click', () => selectDifficulty('ultra')); // Event listener for Ultra button

            // Initial load: default to Easy or load from localStorage
            const storedDifficulty = localStorage.getItem('gameDifficulty');
            if (storedDifficulty) {
                selectDifficulty(storedDifficulty);
            } else {
                selectDifficulty('easy'); // Default if no difficulty is stored
            }

            // retrieve the last time the repo was updated
            fetch('https://api.github.com/repos/neilschreiner/GuessTheCategory')
              .then(response => response.json())
              .then(data => {
                const lastUpdated = new Date(data.pushed_at);
                const formattedDate = lastUpdated.toLocaleDateString() + ' ' + lastUpdated.toLocaleTimeString();
                document.getElementById('last-updated').textContent = formattedDate;
              })
              .catch(error => console.error('Error fetching data:', error));
        });
    </script>
</body>
</html>
